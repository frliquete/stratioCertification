{"id":"ca55388a-b3ab-4381-a82f-0fbc79fe0264","name":"01-credit-scoring-data-preparation","description":"We will preprocess the dirty data to clean it and ensure certain data quality","settings":{"global":{"executionMode":"marathon","userPluginsJars":[],"preExecutionSqlSentences":[],"postExecutionSqlSentences":[],"addAllUploadedPlugins":true,"mesosConstraint":"","mesosConstraintOperator":"CLUSTER","parametersLists":["Environment"],"parametersUsed":["Global.SPARK_CORES_MAX","Global.SPARK_DRIVER_CORES","Global.SPARK_DRIVER_JAVA_OPTIONS","Global.SPARK_DRIVER_MEMORY","Global.SPARK_EXECUTOR_CORES","Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS","Global.SPARK_EXECUTOR_MEMORY","Global.SPARK_LOCALITY_WAIT","Global.SPARK_LOCAL_PATH","Global.SPARK_MEMORY_FRACTION","Global.SPARK_TASK_MAX_FAILURES"],"udfsToRegister":[],"udafsToRegister":[],"mesosRole":"","marathonDeploymentSettings":{"gracePeriodSeconds":"","intervalSeconds":"","timeoutSeconds":"","maxConsecutiveFailures":"","forcePullImage":false,"privileged":false,"userEnvVariables":[],"userLabels":[],"logLevel":""},"enableQualityRules":true},"streamingSettings":{"window":"2s","blockInterval":"100ms","checkpointSettings":{"checkpointPath":"sparta/checkpoint","enableCheckpointing":true,"autoDeleteCheckpoint":true,"addTimeToCheckpointPath":false}},"sparkSettings":{"master":"mesos://zk://master.mesos:2181/mesos","sparkKerberos":true,"sparkDataStoreTls":true,"sparkMesosSecurity":true,"submitArguments":{"userArguments":[],"deployMode":"client","driverJavaOptions":"{{{Global.SPARK_DRIVER_JAVA_OPTIONS}}}"},"sparkConf":{"sparkResourcesConf":{"coresMax":"{{{Global.SPARK_CORES_MAX}}}","executorMemory":"{{{Global.SPARK_EXECUTOR_MEMORY}}}","executorCores":"{{{Global.SPARK_EXECUTOR_CORES}}}","driverCores":"{{{Global.SPARK_DRIVER_CORES}}}","driverMemory":"{{{Global.SPARK_DRIVER_MEMORY}}}","mesosExtraCores":"","localityWait":"{{{Global.SPARK_LOCALITY_WAIT}}}","taskMaxFailures":"{{{Global.SPARK_TASK_MAX_FAILURES}}}","sparkMemoryFraction":"{{{Global.SPARK_MEMORY_FRACTION}}}","sparkParallelism":""},"sparkHistoryServerConf":{"enableHistoryServerMonitoring":false,"sparkHistoryServerEventLogRotateEnable":false,"sparkHistoryServerEventLogRotateNum":"9","sparkHistoryServerEventLogRotateSize":"512"},"userSparkConf":[],"coarse":true,"sparkUser":"root","sparkLocalDir":"{{{Global.SPARK_LOCAL_PATH}}}","sparkKryoSerialization":false,"sparkSqlCaseSensitive":true,"logStagesProgress":false,"hdfsTokenCache":true,"executorExtraJavaOptions":"{{{Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS}}}"}},"errorsManagement":{"genericErrorManagement":{"whenError":"Error"},"transformationStepsManagement":{"whenError":"Error","whenRowError":"RowError","whenFieldError":"FieldError"},"transactionsManagement":{"sendToOutputs":[],"sendStepData":false,"sendPredecessorsData":true,"sendInputData":true}}},"pipelineGraph":{"nodes":[{"name":"ControlPointHistoricData","stepType":"Transformation","className":"DataProfilingTransformStep","classPrettyName":"DataProfiling","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":""},"uiConfiguration":{"position":{"x":600.0213623046875,"y":22.28673553466797}},"configuration":{"analysisType":"DATASET","inputSchemas":"[]"},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"ControlPointNoDebt","stepType":"Transformation","className":"DataProfilingTransformStep","classPrettyName":"DataProfiling","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":""},"uiConfiguration":{"position":{"x":803.1699829101562,"y":161.2362518310547}},"configuration":{"analysisType":"DATASET","inputSchemas":"[]"},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"RenameYear","stepType":"Transformation","className":"RenameColumnTransformStep","classPrettyName":"RenameColumns","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":800.0184326171875,"y":305.573486328125}},"configuration":{"columns":[{"name":"year","alias":"year"},{"name":"saving_accounts","alias":"saving_accounts"},{"name":"checking_account","alias":"checking_account"},{"name":"credit_amount","alias":"credit_amount"}],"inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"ControlPointCertifiedData","stepType":"Transformation","className":"DataProfilingTransformStep","classPrettyName":"DataProfiling","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":""},"uiConfiguration":{"position":{"x":1355.6324462890625,"y":22.502262115478516}},"configuration":{"analysisType":"DATASET","inputSchemas":"[]"},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"ControlPointDiscardedData","stepType":"Transformation","className":"DataProfilingTransformStep","classPrettyName":"DataProfiling","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1296.298761531408,"y":541.0679029809056}},"configuration":{"analysisType":"DATASET","inputSchemas":"[]"},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"Profiling_logs","stepType":"Output","className":"PrintOutputStep","classPrettyName":"Print","arity":["NullaryToNullary","NaryToNullary"],"writer":{"saveMode":"Append"},"uiConfiguration":{"position":{"x":1063.6649320562049,"y":22.199309442213348}},"configuration":{"printData":true,"printSchema":false,"errorSink":false,"printMetadata":true,"logLevel":"info"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[]},{"name":"Profiling_logs_dsicarded_data","stepType":"Output","className":"PrintOutputStep","classPrettyName":"Print","arity":["NullaryToNullary","NaryToNullary"],"writer":{"saveMode":"Append"},"uiConfiguration":{"position":{"x":1297.1226050969624,"y":669.2766254937032}},"configuration":{"printData":true,"printSchema":false,"errorSink":false,"printMetadata":true,"logLevel":"info"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[]},{"name":"InformationIndex","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1181.5090157131945,"y":304.65919348507254}},"configuration":{"sql":"SELECT (\n    (1 - ((CASE WHEN ID = 'NA' THEN 1 ELSE 0 END) + \n \t(CASE WHEN current_debt = 'NA' THEN 1 ELSE 0 END) +\n \t(CASE WHEN year = 'NA' THEN 1 ELSE 0 END) +\n \t(CASE WHEN age = 'NA' THEN 1 ELSE 0 END) +\n \t(CASE WHEN sex = 'NA' THEN 1 ELSE 0 END) +\n \t(CASE WHEN job = 'NA' THEN 1 ELSE 0 END) +\n \t(CASE WHEN housing = 'NA' THEN 1 ELSE 0 END) +\n  \t(CASE WHEN saving_accounts = 'NA' THEN 1 ELSE 0 END) + \n\t(CASE WHEN checking_account = 'NA' THEN 1 ELSE 0 END) + \n  \t(CASE WHEN credit_amount = 'NA' THEN 1 ELSE 0 END) + \n  \t(CASE WHEN duration = 'NA' THEN 1 ELSE 0 END) +\n \t(CASE WHEN purpose = 'NA' THEN 1 ELSE 0 END) + \n   \t(CASE WHEN risk = 'NA' THEN 1 ELSE 0 END)) / 12)) \n\t AS information_index , RenameYear.* \n\t \nFROM RenameYear","discardConditions":"[]","inputSchemas":"[]","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"RemoveChildrensColumn","stepType":"Transformation","className":"DropColumnsTransformStep","classPrettyName":"DropColumns","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":""},"uiConfiguration":{"position":{"x":984.1892922618936,"y":306.0773385038176}},"configuration":{"schema.fields":[{"name":"Children"}],"inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"Repartition","stepType":"Transformation","className":"RepartitionTransformStep","classPrettyName":"Repartition","arity":[],"writer":{"saveMode":"Overwrite","tableName":"default.risk_scoring_data_ok ","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1699.124801553335,"y":305.7259273479108}},"configuration":{"partitions":"1","columns":"[]","inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"QualityRules","stepType":"Transformation","className":"FilterTransformStep","classPrettyName":"Filter","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"DiscardedClientData","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1357.2611049223035,"y":302.16678961079475}},"configuration":{"filterExp":"information_index > 0.8 AND year > 2000 AND age < 120 AND (sex = 'male' OR sex = 'female')\nAND ID  is not null AND\nchildren  is not null AND\ncurrent_debt  is not null AND\nyear  is not null AND\nage  is not null AND\nsex  is not null AND\njob  is not null AND\nhousing  is not null AND\nsaving_accounts  is not null AND\nchecking_account  is not null AND\ncredit_amount  is not null AND\nduration  is not null AND\npurpose  is not null AND\nrisk  is not null ","inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"CertifiedClientData","stepType":"Output","className":"ParquetOutputStep","classPrettyName":"Parquet","arity":["NullaryToNullary","NaryToNullary"],"writer":{"saveMode":"Append"},"uiConfiguration":{"position":{"x":1706.616995921002,"y":516.8521071693426}},"configuration":{"path":"/use-cases/risk-scoring/output/parquet","errorSink":false,"saveOptions":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[]},{"name":"DiscardedClientData","stepType":"Output","className":"ParquetOutputStep","classPrettyName":"Parquet","arity":["NullaryToNullary","NaryToNullary"],"writer":{"saveMode":"Append"},"uiConfiguration":{"position":{"x":1459.7781446841093,"y":540.8039003779348}},"configuration":{"path":"/use-cases/risk-scoring/output/parquet","errorSink":false,"saveOptions":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[]},{"name":"rawData","stepType":"Input","className":"CrossdataInputStep","classPrettyName":"Crossdata","arity":["NullaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":64.23455998579885,"y":123.04581064955818}},"configuration":{"query":"select * from  risk_scoring","tlsEnabled":false,"debugOptions":"{\"query\":\"select * from  risk_scoring limit 1000\"}"},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]},{"name":"QueryBuilder","stepType":"Transformation","className":"QueryBuilderTransformStep","classPrettyName":"QueryBuilder","arity":["UnaryToNary","BinaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":568.333286916461,"y":295.05634423443763}},"configuration":{"inputSchemas":"[]","executeSqlWhenEmpty":true,"visualQuery":{"selectClauses":[{"expression":"t1.*"}],"whereClause":"","orderByClauses":[],"fromClause":{"tableName":"Crossdata","alias":"t1"}},"backup":{"selectedInputSchemas":{},"outputSchemaFields":[{"table":"Crossdata","expression":"t1.*","originFields":[{"alias":"t1","name":"*","table":"Crossdata"}],"position":{"x":881.8333740234375,"y":155.58331298828125,"height":41}}],"inputSchemaFields":[{"name":"Crossdata","alias":"t1","fields":[{"column":"ID","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"children","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"current_debt","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"year","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"age","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"sex","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"job","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"housing","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"saving_accounts","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"checking_account","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"credit_amount","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"duration","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"purpose","fieldType":"string","alias":"t1","table":"Crossdata"},{"column":"risk","fieldType":"string","alias":"t1","table":"Crossdata"}]}],"showRelationPaths":true,"join":{"type":"INNER","joins":[]},"filter":""}},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[]},{"name":"risk_scoring_data_ok ","stepType":"Output","className":"CrossdataOutputStep","classPrettyName":"Crossdata","arity":["NullaryToNullary","NaryToNullary"],"writer":{"saveMode":"Append"},"uiConfiguration":{"position":{"x":1900.1425582678194,"y":305.7543261567589}},"configuration":{"tlsEnabled":"","errorSink":false},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[]},{"name":"DropColumns","stepType":"Transformation","className":"DropColumnsTransformStep","classPrettyName":"DropColumns","arity":["UnaryToNary"],"writer":{"saveMode":"Append","tableName":"","partitionBy":"","errorTableName":"","discardTableName":""},"uiConfiguration":{"position":{"x":1528.3477005540678,"y":305.47875630487846}},"configuration":{"schema.fields":[{"name":"information_index"}],"inputSchemas":"[]"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[]}],"edges":[{"origin":"ControlPointNoDebt","destination":"Profiling_logs","dataType":"ValidData"},{"origin":"ControlPointDiscardedData","destination":"Profiling_logs_dsicarded_data","dataType":"ValidData"},{"origin":"ControlPointHistoricData","destination":"Profiling_logs","dataType":"ValidData"},{"origin":"ControlPointCertifiedData","destination":"Profiling_logs","dataType":"ValidData"},{"origin":"RemoveChildrensColumn","destination":"InformationIndex","dataType":"ValidData"},{"origin":"RenameYear","destination":"RemoveChildrensColumn","dataType":"ValidData"},{"origin":"InformationIndex","destination":"QualityRules","dataType":"ValidData"},{"origin":"QualityRules","destination":"ControlPointDiscardedData","dataType":"DiscardedData"},{"origin":"QualityRules","destination":"ControlPointCertifiedData","dataType":"ValidData"},{"origin":"QualityRules","destination":"DiscardedClientData","dataType":"DiscardedData"},{"origin":"rawData","destination":"ControlPointHistoricData","dataType":"ValidData"},{"origin":"rawData","destination":"QueryBuilder","dataType":"ValidData"},{"origin":"QueryBuilder","destination":"RenameYear","dataType":"ValidData"},{"origin":"Repartition","destination":"risk_scoring_data_ok ","dataType":"ValidData"},{"origin":"QueryBuilder","destination":"ControlPointNoDebt","dataType":"ValidData"},{"origin":"QualityRules","destination":"DropColumns","dataType":"ValidData"},{"origin":"DropColumns","destination":"Repartition","dataType":"ValidData"},{"origin":"Repartition","destination":"CertifiedClientData","dataType":"ValidData"}]},"executionEngine":"Batch","uiSettings":{"position":{"x":-927.913317915044,"y":-105.57245293441963,"k":1.1914480104198966}},"lastUpdateDate":"2019-12-10T13:53:33Z","version":3,"group":{"id":"a1c156b1-ccf8-44c7-b684-e26c0964ed2d","name":"/home/use-cases/risk-scoring/streaming-risk-scoring"},"debugMode":false,"versionSparta":"2.9.0-9dee11d","groupId":"a1c156b1-ccf8-44c7-b684-e26c0964ed2d"}